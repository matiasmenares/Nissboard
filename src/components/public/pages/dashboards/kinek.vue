<template>
      <div id="kinek-div">
        <b-row no-gutters>
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="z-index: 10; width: 800px; height: 80px; font-weight: bold;">
                <g style="fill:none;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;">
                    <path d="M   10,0   10,10 M   20,0   20,10   M  30,0 30,10  M   40,0   40,10 M   50,0   50,20 M   60,0   60,10 M   70,0   70,10 M   80,0   80,10 M   90,0   90,10 M  100,0  100,30
                            M  110,0  110,10 M  120,0  120,10   M 130,0 130,10 M  140,0  140,10 M  150,0  150,20 M  160,0  160,10 M  170,0  170,10 M  180,0  180,10 M  190,0  190,10 M  200,0  200,30
                            M  210,0  210,10 M  220,0  220,10   M 230,0 230,10 M  240,0  240,10 M  250,0  250,20 M  260,0  260,10 M  270,0  270,10 M  280,0  280,10 M  290,0  290,10 M  300,0  300,30
                            M  310,0  310,10 M  320,0  320,10   M 330,0 330,10 M  340,0  340,10 M  350,0  350,20 M  360,0  360,10 M  370,0  370,10 M  380,0  380,10 M  390,0  390,10 M  400,0  400,30
                            M  410,0  410,10 M  420,0  420,10   M 430,0 430,10 M  440,0  440,10 M  450,0  450,20 M  460,0  460,10 M  470,0  470,10 M  480,0  480,10 M  490,0  490,10 M  500,0  500,30
                            M  510,0  510,10 M  520,0  520,10   M 530,0 530,10 M  540,0  540,10 M  550,0  550,20 M  560,0  560,10 M  570,0  570,10 M  580,0  580,10 M  590,0  590,10 M  600,0  600,30
                            M  610,0  610,10 M  620,0  620,10   M 630,0 630,10 M  640,0  640,10 M  650,0  650,20 M  660,0  660,10 M  670,0  670,10 M  680,0  680,10 M  690,0  690,10 M  700,0  700,30
                            M  710,0  710,10 M  720,0  720,10   M 730,0 730,10 M  740,0  740,10 M  750,0  750,20 M  760,0  760,10 M  770,0  770,10 M  780,0  780,10 M  790,0  790,10 M  800,0  800,30
                            M  810,0  810,10 M  820,0  820,10   M 830,0 830,10 M  840,0  840,10 M  850,0  850,20 M  860,0  860,10 M  870,0  870,10 M  880,0  880,10 M  890,0  890,10 M  900,0  900,30
                            M  910,0  910,10 M  920,0  920,10   M 930,0 930,10 M  940,0  940,10 M  950,0  950,20 M  960,0  960,10 M  970,0  970,10 M  980,0  980,10 M  990,0  990,10 M 1000,0 1000,30
                            M 1010,0 1010,10 M 1020,0 1020,10 M 1030,0 1030,10 M 1040,0 1040,10 M 1050,0 1050,20 M 1060,0 1060,10 M 1070,0 1070,10 M 1080,0 1080,10 M 1090,0 1090,10 M 1100,0 1100,30
                            M 1110,0 1110,10 M 1120,0 1120,10 M 1130,0 1130,10 M 1140,0 1140,10 M 1150,0 1150,20 M 1160,0 1160,10 M 1170,0 1170,10 M 1180,0 1180,10 M 1190,0 1190,10 M 1200,0 1200,30
                            M 1210,0 1210,10 M 1220,0 1220,10 M 1230,0 1230,10 M 1240,0 1240,10 M 1250,0 1250,20 M 1260,0 1260,10 M 1270,0 1270,10 M 1280,0 1280,10 M 1290,0 1290,10 M 1300,0 1300,30
                            M 1310,0 1310,10 M 1320,0 1320,10 M 1330,0 1330,10 M 1340,0 1340,10 M 1350,0 1350,20 M 1360,0 1360,10 M 1370,0 1370,10 M 1380,0 1380,10 M 1390,0 1390,10 M 1400,0 1400,30
                            M 1410,0 1410,10 M 1420,0 1420,10 M 1430,0 1430,10 M 1440,0 1440,10 M 1450,0 1450,20 M 1460,0 1460,10 M 1470,0 1470,10 M 1480,0 1480,10 M 1490,0 1490,10 M 1500,0 1500,30
                            M 1510,0 1510,10 M 1520,0 1520,10 M 1530,0 1530,10 M 1540,0 1540,10 M 1550,0 1550,20 M 1560,0 1560,10 M 1570,0 1570,10 M 1580,0 1580,10 M 1590,0 1590,10 M 1600,0 1600,30
                            M 1610,0 1610,10 M 1620,0 1620,10 M 1630,0 1630,10 M 1640,0 1640,10 M 1650,0 1650,20 M 1660,0 1660,10 M 1670,0 1670,10 M 1680,0 1680,10 M 1690,0 1690,10 M 1700,0 1700,30
                            M 1710,0 1710,10 M 1720,0 1720,10 M 1730,0 1730,10 M 1740,0 1740,10 M 1750,0 1750,20 M 1760,0 1760,10 M 1770,0 1770,10 M 1780,0 1780,10 M 1790,0 1790,10 M 1800,0 1800,30"
                            transform="translate(-0.5 0)" style="stroke:#FFFFFF;"/>
                </g>
                <g style="fill-rule:nonzero;fill-opacity:1;stroke:none;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;text-anchor:middle;font-family:Arial;font-size:15;">
                    <g style="fill:#FFFFFF;">
                    <text x="0"    y="0">0</text>
                    <text x="100"  y="55">1</text>
                    <text x="200"  y="55">2</text>
                    <text x="300"  y="55">3</text>
                    <text x="400"  y="55">4</text>
                    <text x="500"  y="55">5</text>
                    <text x="600"  y="55">6</text>
                    <text x="700"  y="55">7</text>
                    <text x="790"  y="55">8</text>
                    </g>
                </g>
            </svg>
            <v-progress-linear
                :background-opacity="0.5"
                :height="80"
                :value="ecu.rpm"
                :color="color.rpm"
                class="sub-block"
            ></v-progress-linear>
        </b-row>
        <b-row no-gutters class="mt-2">
           <b-col class="text-center mt-12 normal-letter">
                <h1>{{ecu.speed}} <span class="min-letter">KPH</span></h1>
            </b-col>
            <b-col class="text-center mt-1 max-letter">
                <h1>{{ecu.rpm}} <span class="min-letter">RPM</span></h1>
            </b-col>
           <b-col class="text-center mt-12  normal-letter">
                <h1>{{ecu.temp}} <span class="min-letter">CÂº</span></h1>
            </b-col>
        </b-row>
        <hr>
        <b-row no-gutters class="mt-5">
           <b-col class="text-center normal-letter" v-if="channel_output[1]">
                <h1>{{channel_output[1]['value']}} <span class="min-letter">{{channel_output[1]['name']}}</span></h1><small>Peak: </small>
            </b-col>
            <b-col class="text-center normal-letter" v-else>
                <h1>- -</h1>
            </b-col>
            <b-col class="text-center normal-letter">
                <h1>{{Math.round((((ecu.tps) * 100)/4100),2)}} % <span class="min-letter"> TPS</span></h1>
            </b-col>
           <b-col class="text-center normal-letter">
                <h1>{{ecu.batt}} <span class="min-letter">V</span></h1>
            </b-col>
           <b-col class="text-center normal-letter" v-if="channel_output[2]">
                <h1>{{channel_output[2]['value']}} <span class="min-letter">{{channel_output[2]['name']}}</span></h1>
            </b-col>
            <b-col class="text-center normal-letter" v-else>
                <h1>- -</h1>
            </b-col>
        </b-row>
        <hr>
        <b-row no-gutters class="mt-5">
           <b-col class="text-center mt-2">
                <h1>00:00:00 <span class="min-letter">Current Lap</span></h1>
            </b-col>
            <b-col class="text-center mt-2">
                <h1>00:00:00 <span class="min-letter"> Best Lap</span></h1>
            </b-col>
           <b-col class="text-center normal-letter">
                <h1>0<span class="min-letter"> Laps</span></h1>
            </b-col>
        </b-row>
    </div>
</template>
<script>
  export default {
    name: 'Kinek',
    data(){
        return{
            sheet: false,
            ecu: {rpm: 0, speed: 0, temp: 0, batt: 0, turbo: 0.0, tps: 0, intake: 0, timming: 0},
            analog: {turbo: { psi: {value: "0.0", raw: "0000", peak: "0.0"}, bar: {value: "0.0", raw: "0000", peak: "0.0"}}},
            channel_output: [],
            slots: [],
            dash_outputs: [],
            color: {rpm: "light-blue"},
            value: 0,
            red_line: 0,
            yellow_line: 0
        }
    },
    components: {
    },
    beforeMount(){
        this.set_dash_output()
    },
    created() {
        // this.set_data()
        this.set_channel_output()
    },
    methods: {
        set_data(){
            this.sockets.subscribe('ecuData', (data) => {
                this.ecu = data;
            })
        },
        set_channel_output(){
            this.sockets.subscribe('channelOutput', (data) => {
                let response = []
                data.map(result => {
                    this.slots.map(slot => {
                        if(slot.channel_output_id == result.id){
                            response[slot.id] = result
                        }
                    })
                })
                this.channel_output = response
            })
        },
        set_dash_output(){
            this.axios.get("dashboards").then(result => {
                this.slots = result.data.dashboard_outputs.filter(slot => slot.dashboard_id == 1 )
                this.red_line = parseInt(result.data["kinkek"][4])
                this.yellow_line = parseInt(result.data["kinkek"][5])
            }).catch(error => {
                console.log(error);
            })
        }
    },
    watch: {
        "ecu.rpm": {
            handler: function() {
                this.value = (this.ecu.rpm * 100) / 9000
                if (this.red_line > 0){
                    if(this.ecu.rpm > this.red_line){
                    //danger
                        this.color.rpm = "red darken-2"
                    }else if(this.yellow_line > 0){
                        if(this.ecu.rpm > this.yellow_line && this.ecu.rpm < this.red_line){
                            //warning
                            this.color.rpm = "amber"
                        }else{
                        //success
                        this.color.rpm = "light-blue" 
                         }
                    }else{
                        //success
                        this.color.rpm = "light-blue" 
                    }
                }else if(this.yellow_line > 0){
                    if(this.ecu.rpm > this.red_line){
                        //warning
                        this.color.rpm = "amber"
                    }
                }else{
                    //success
                    this.color.rpm = "light-blue"
                }
            }
        },
        "ecu.mph": {
            handler: function() {
            }
        },
        "ecu.coolantTemp": {
            handler: function() {
                if(this.ecu.coolantTemp > 120) {
                    this.color.coolantTemp = "#FF3232"
                } else if(this.ecu.coolantTemp > 90 && this.ecu.coolantTemp < 120) {
                    this.color.coolantTemp = "#008000"
                } else {
                    this.color.coolantTemp = "#0000FF"
                }
            }
        },
    }
  }
</script>

<style scoped>
@import url('https://fonts.googleapis.com/css?family=Chakra+Petch');
#kinek-div {
  font-family: 'Chakra Petch', sans-serif;
}
.normal-letter{
  font-size: 20px;
}
.max-letter {
  font-size: 40px;
}
.min-letter {
  font-size: 15px;
}
svg {
  position: absolute;
  width: 100%;
  height: 100%;
  margin: 0px;
  border: 0px;
  padding: 0px;
  overflow: hidden;
}
</style>

